generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(cuid())
  supabaseUserId String          @unique
  email          String          @unique
  name           String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  links          AffiliateLink[]
  customLinks    CustomLink[]
}

model UserProfile {
  id              String   @id @default(cuid())
  name            String   @default("Enes Ã–zen")
  bio             String?
  profileImageUrl String?
  attentionText   String?
  instagramUrl    String?
  youtubeUrl      String?
  tiktokUrl       String?
  whatsappUrl     String?
  telegramUrl     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("UserProfile")
}

model Category {
  id          String          @id @default(cuid())
  name        String
  description String?
  color       String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  imageUrl    String?
  order       Int             @default(0)
  links       AffiliateLink[]
  lists       CuratedList[]

  @@index([order])
}

model EcommerceBrand {
  id          String          @id @default(cuid())
  name        String          @unique
  slug        String          @unique
  logo        String?
  color       String?
  website     String?
  description String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  links       AffiliateLink[]
  listUrls    ListUrl[]
  productUrls ProductUrl[]

  @@index([slug])
  @@index([isActive])
}

model AffiliateLink {
  id               String          @id @default(cuid())
  title            String
  description      String?
  originalUrl      String?
  shortUrl         String          @unique
  customSlug       String?         @unique
  userId           String
  categoryId       String?
  ecommerceBrandId String?
  isActive         Boolean         @default(true)
  clickCount       Int             @default(0)
  tags             String[]
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  imageUrl         String?
  youtubeUrl       String?
  category         Category?       @relation(fields: [categoryId], references: [id])
  ecommerceBrand   EcommerceBrand? @relation(fields: [ecommerceBrandId], references: [id])
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  clicks           Click[]
  lists            ListedLink[]
  productUrls      ProductUrl[]

  @@index([userId])
  @@index([categoryId])
  @@index([ecommerceBrandId])
  @@index([shortUrl])
  @@index([isActive])
}

model ProductUrl {
  id               String         @id @default(cuid())
  linkId           String
  ecommerceBrandId String
  url              String
  isPrimary        Boolean        @default(false)
  order            Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  clicks           Click[]
  ecommerceBrand   EcommerceBrand @relation(fields: [ecommerceBrandId], references: [id], onDelete: Cascade)
  link             AffiliateLink  @relation(fields: [linkId], references: [id], onDelete: Cascade)

  @@unique([linkId, ecommerceBrandId])
  @@index([linkId])
  @@index([ecommerceBrandId])
  @@index([isPrimary])
}

model Click {
  id           String        @id @default(cuid())
  linkId       String
  ipAddress    String?
  userAgent    String?
  referrer     String?
  country      String?
  city         String?
  device       String?
  browser      String?
  converted    Boolean       @default(false)
  timestamp    DateTime      @default(now())
  productUrlId String?
  link         AffiliateLink @relation(fields: [linkId], references: [id], onDelete: Cascade)
  productUrl   ProductUrl?   @relation(fields: [productUrlId], references: [id])

  @@index([linkId])
  @@index([productUrlId])
  @@index([timestamp])
}

model CuratedList {
  id              String       @id @default(cuid())
  title           String
  slug            String       @unique
  description     String?
  coverImage      String?
  youtubeUrl      String?
  isFeatured      Boolean      @default(false)
  categoryId      String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  shortUrl        String?      @unique
  showDirectLinks Boolean      @default(false)
  clickCount      Int          @default(0)
  category        Category?    @relation(fields: [categoryId], references: [id])
  listClicks      ListClick[]
  listUrls        ListUrl[]
  links           ListedLink[]

  @@index([categoryId])
  @@index([slug])
  @@index([shortUrl])
  @@index([isFeatured])
}

model ListedLink {
  id        String        @id @default(cuid())
  listId    String
  linkId    String
  order     Int           @default(0)
  createdAt DateTime      @default(now())
  link      AffiliateLink @relation(fields: [linkId], references: [id], onDelete: Cascade)
  list      CuratedList   @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@unique([listId, linkId])
  @@index([listId])
  @@index([linkId])
  @@index([order])
}

model ListUrl {
  id               String         @id @default(cuid())
  listId           String
  ecommerceBrandId String
  url              String
  isPrimary        Boolean        @default(false)
  order            Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  clicks           ListClick[]
  ecommerceBrand   EcommerceBrand @relation(fields: [ecommerceBrandId], references: [id], onDelete: Cascade)
  list             CuratedList    @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@unique([listId, ecommerceBrandId])
  @@index([listId])
  @@index([ecommerceBrandId])
  @@index([isPrimary])
}

model ListClick {
  id        String      @id @default(cuid())
  listId    String
  listUrlId String?
  ipAddress String?
  userAgent String?
  referrer  String?
  country   String?
  city      String?
  device    String?
  browser   String?
  converted Boolean     @default(false)
  timestamp DateTime    @default(now())
  list      CuratedList @relation(fields: [listId], references: [id], onDelete: Cascade)
  listUrl   ListUrl?    @relation(fields: [listUrlId], references: [id])

  @@index([listId])
  @@index([listUrlId])
  @@index([timestamp])
}

model CustomLink {
  id          String   @id @default(cuid())
  title       String
  targetUrl   String
  shortUrl    String   @unique
  description String?
  isActive    Boolean  @default(true)
  clickCount  Int      @default(0)
  userId      String
  tags        String[]
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  clicks      CustomLinkClick[]

  @@index([userId])
  @@index([shortUrl])
  @@index([isActive])
}

model CustomLinkClick {
  id          String     @id @default(cuid())
  customLinkId String
  ipAddress   String?
  userAgent   String?
  referrer    String?
  country     String?
  city        String?
  device      String?
  browser     String?
  converted   Boolean    @default(false)
  timestamp   DateTime   @default(now())
  customLink CustomLink @relation(fields: [customLinkId], references: [id], onDelete: Cascade)

  @@index([customLinkId])
  @@index([timestamp])
}
